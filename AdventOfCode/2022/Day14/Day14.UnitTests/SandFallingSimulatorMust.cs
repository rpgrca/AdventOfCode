using Day14.Logic;
using static Day14.UnitTests.Constants;

namespace Day14.UnitTests;

public class SandFallingSimulatorMust
{
    [Fact]
    public void LoadSampleMapCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        Assert.Equal(@"..........
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
........#.
#########.", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(0, sut.UnitsOfSand);
    }

    [Fact]
    public void LoadPuzzleMapCorrectly()
    {
        var sut = new SandFallingSimulator(PUZZLE_INPUT);
        Assert.Equal(@".............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
...............................................######........
.............................................................
............................................######.######....
.............................................................
.........................................######.######.######
.............................................................
.............................................................
......................................#####..................
.............................................................
.............................................................
...................................#####.#####...............
.............................................................
.............................................................
................................#####.#####.#####............
.............................................................
.............................................................
.............................#####.#####.#####.#####.........
.............................................................
.............................................................
................................#............................
...........................######............................
.............................................................
.............................................................
........................#...#................................
........................#...#................................
..................#######...#####............................
..................#.............#............................
..................#.............#............................
..................###############............................
.............................................................
.............................................................
.............................................................
.................................#...........................
.................................#...........................
...............................#.#...........................
...............................#.#...........................
...............................#.#...........................
...............................#.#...........................
...............................#.#...........................
...............................#.#.#.........................
...............................#.#.#.........................
...............................#####.........................
.............................................................
.............................................................
.............................................................
.............................................................
...........................#.................................
...........................###################...............
.............................................................
.............................................................
...........................................######............
.............................................................
........................................######.######........
.............................................................
.....................................######.######.######....
.............................................................
..................................######.######.######.######
.............................................................
.............................................................
.............................................................
........................#...........#........................
........................#############........................
.............................................................
.............................................................
....................######...................................
.............................................................
.................######.######...............................
.............................................................
..............######.######.######...........................
.............................................................
.............................................................
............#...#............................................
............#...#............................................
............#...#............................................
.....########...####.........................................
.....#.............#.........................................
.....#.............#.........................................
.....#.............#.........................................
.....###############.........................................
.............................................................
.............................................................
.............................................................
.............................................................
.............................................................
...#.........................................................
...#.........................................................
...#.........................................................
...#.#.......................................................
...#.#.......................................................
...#.#.......................................................
.#.#.#.......................................................
.#####.......................................................
.............................................................
.............................................................
....#....#...................................................
....#....#...................................................
....#....#...................................................
#####....#########...........................................
#................#...........................................
#................#...........................................
#................#...........................................
##################...........................................
.............................................................
.............................................................
...............#.....#.......................................
...............#.....#.......................................
...............#.....#.......................................
..............##.....######..................................
..............#...........#..................................
..............#...........#..................................
..............#############..................................
.............................................................
.............................................................
.............................................................
.............................................................
.......................#.....................................
.......................#.....................................
.....................#.#.....................................
.....................#.#.....................................
.....................#.#.#.....#.............................
.....................#.#.#.#.#.#.............................
.....................#.#.#.#.#.#.............................
.....................#.#.#.#.#.#.............................
.....................###########.............................
.............................................................
.............................................................
.............................................................
...........................############......................
.............................................................
.............................................................
.......................................#.....................
.......................................#.....................
...................................#...#.....................
...................................#...#.....................
...................................#...#.....................
...................................#...#.#...................
...................................#...#.#...................
...................................#...#.#...................
...................................#...#.#...................
...................................#.#.#.#...................
...................................#######...................", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(0, sut.UnitsOfSand);
    }

    [Fact]
    public void DropSandDownCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSands(1);
        Assert.Equal(@"..........
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
......o.#.
#########.", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(1, sut.UnitsOfSand);
    }

    [Fact]
    public void RollSandLeftCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSands(2);
        Assert.Equal(@"..........
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
.....oo.#.
#########.", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(2, sut.UnitsOfSand);
    }

    [Fact]
    public void RollSandRightCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSands(5);
        Assert.Equal(@"..........
..........
..........
..........
....#...##
....#...#.
..###...#.
......o.#.
....oooo#.
#########.", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(5, sut.UnitsOfSand);
    }

    [Theory]
    [InlineData(22, @"..........
..........
......o...
.....ooo..
....#ooo##
....#ooo#.
..###ooo#.
....oooo#.
...ooooo#.
#########.")]
    [InlineData(24, @"..........
..........
......o...
.....ooo..
....#ooo##
...o#ooo#.
..###ooo#.
....oooo#.
.o.ooooo#.
#########.")]
    public void SimulateSandFallingCorrectly(int units, string expectedMap)
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSands(units);
        Assert.Equal(expectedMap, sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(units, sut.UnitsOfSand);
    }

    [Fact]
    public void SimulateSandFallingToTheAbyssCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSands(25);
        Assert.Equal(@"..........
..........
......o...
.....ooo..
....#ooo##
...o#ooo#.
..###ooo#.
....oooo#.
.o.ooooo#.
#########.", sut.GetVisualMap());
        Assert.True(sut.MapFilled);
        Assert.Equal(24, sut.UnitsOfSand);
    }

    [Fact]
    public void SolveFirstSampleCorrectly()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT);
        sut.DropUnitOfSandsUntilFilled();
        Assert.Equal(24, sut.UnitsOfSand);
    }

    [Fact]
    public void SolveFirstPuzzleCorrectly()
    {
        var sut = new SandFallingSimulator(PUZZLE_INPUT);
        sut.DropUnitOfSandsUntilFilled();
        Assert.Equal(774, sut.UnitsOfSand);
    }

    [Fact]
    public void Test1()
    {
        var sut = new SandFallingSimulator(SAMPLE_INPUT, true);
        Assert.Equal(@"..............................
..............................
..............................
..............................
..............#...##..........
..............#...#...........
............###...#...........
..................#...........
..................#...........
..........#########...........
..............................
##############################", sut.GetVisualMap());
        Assert.False(sut.MapFilled);
        Assert.Equal(0, sut.UnitsOfSand);

    }
}